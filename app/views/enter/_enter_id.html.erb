
<script type="text/javascript"><!--

$(function() {

  const fullKataId = $('#full-kata-id');
  const kataIdInput = $('#kata-id-input');
  const buttons = $('#start-button, #resume-button');
  var state = 'hidden';

  const enableButtons = function() {
    if (state == 'hidden') {
      buttons.show('slow');
      buttons.removeAttr('disabled');
      state = 'shown';
    }
  };
  const disableButtons = function() {
    if (state == 'shown') {
      buttons.prop('disabled', true);
      buttons.hide('slow');
      state = 'hidden';
    }
  };

  const enableDisableStartResume = function() {
    const id = kataIdInput.val();
    if (id.length <= 5) {
      disableButtons();
    } else {
      $.getJSON('/enter/check', { id: id }, function(dojo) {
        if (dojo.exists) {
          fullKataId.val(dojo.full_id);
          enableButtons();
        } else {
          fullKataId.val('');
          disableButtons();
        }
      });
    }
  };

  // Only accept hex input.
  // Also accepts a Ctrl-V paste event which will allow
  // non-hex chars to be entered.
  kataIdInput.keypress(function(e) {
    var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
    if (e.which == 0 || e.charCode == 0) { // special key
      return true;
    }
    else if (str.match(/[a-fA-F0-9]/)) { // hex key
      return true;
    }
    else {
      e.preventDefault();
      return false;
    }
  });

  kataIdInput.keyup(function() { enableDisableStartResume(); });
  kataIdInput.focus();

  enableDisableStartResume();

});

//--></script>

<input type="hidden"
         id="full-kata-id">
</input>

<input title="an id contains only the digits 0123456789 and letters ABCDEF, and is case insensitive"
       type="text"
       id="kata-id-input"
       placeholder="what is its id?"
       size="8"
       value="<%= @id[0..5] %>">
</input>
