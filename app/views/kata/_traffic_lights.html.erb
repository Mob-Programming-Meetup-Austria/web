<script type="text/javascript"><!--
'use strict';
$(() => {

  const review = $('#review-dialog')
    .dialog({
        dialogClass: 'no-title',
              width: 1150,
             height: 650,
              modal: true,
           autoOpen: false,
      closeOnEscape: true,
    });

  cd.setupReviewTrafficLights = ($lights) => {
    // also called from run_tests.js.erb
    $lights.each((_index,element) => {
      const light = $(element);
      const id     = light.data('id');
      const avatar = "<%= @kata.avatar_name %>";
      const nowTag = light.data('tag');
      const wasTag = nowTag - 1;
      light.click(() => {
        cd.setReviewDialogData(id, avatar, wasTag, nowTag);
        review.dialog('open');
      });
    });
  };

  cd.setupReviewTrafficLights($('.diff-traffic-light'));
  cd.setupHoverTips($('[data-tip]'));

});
//--></script>

<div id="traffic-lights">
  <table>
    <tr>
      <% @kata.lights.each do |light| %>
        <td><%= raw diff_traffic_light(light) %></td>
      <% end %>
      <td><%= render partial: 'traffic_lights_count' %></td>
      <td><%= render partial: 'traffic_lights_pie_chart' %></td>
      <td><%= render partial: 'avatar_image' %></td>
      <td><%= render partial: 'scroll_handle' %></td>
    </tr>
  </table>
</div>

<div style="display:none;">
  <div id="review-dialog">
    <%= render partial: 'review/review', locals: { inDialog:true } %>
  </div>
</div>
