<script type="text/javascript"><!--
'use strict';
$(() => {

  // Ready to take place of last data coming back from /differ/diff call

  cd.review.groupNeghbours = (id, joined) => {
    if (isEmpty(joined)) {
      return [ '', null, '' ];
    }
    // eg id = "Q55b8b"
    // eg joined = {
    //      "15" => { "id" => "EEJSkR", "events"=>[0,1,2]   }, # 15 == fox
    //      "23" => { "id" => "Q55b8b", "events"=>[0,1,2,3] }, # 23 == jellyfish
    //       "2" => { "id" => "w34rd5", "events"=>[0]       }, #  2 == bat
    //      ...
    //   }

    const active = 
        Object.keys(joined)
              .filter((key) => joined[key].events.length > 1)
              .map((key) => [ parseInt(key), joined[key].id ])
              .sort((lhs,rhs) => lhs[0] - rhs[0]);

    // eg active = [
    //      [ 15, "EEJSkR" ],
    //      [ 23, "Q55b8b" ], // 1 <<<<<< index
    //      ...
    //  ]

    const index = active.findIndex((e) => e[1] === id);
    const prevId = (index-1 >= 0) ? active[index-1][1] : '';
    const nextId = (index+1 < active.length) ? active[index+1][1] : '';

    return [ prevId, active[index][0], nextId ];
  };

  const isEmpty = (o) => Object.keys(o).length === 0;

});
//--></script>
